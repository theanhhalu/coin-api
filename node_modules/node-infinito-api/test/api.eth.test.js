const { Helper } = require('node-infinito-util');
const InfinitoApi = require('../index');
const ConfigTest = require('./config.test');
const chai = require("chai");
chai.should();

const opts = {
  apiKey: ConfigTest.API_KEY,
  secret: ConfigTest.SECRECT,
  baseUrl: ConfigTest.BASE_URL,
  logLevel: ConfigTest.LOG_LEVEL
};

const addresses = {
  normal: "0x515279921110c4ff12603c20bbe16c751cb1304f",
  sc: "0x86fa049857e0209aa7d9e616f7eb3b3b78ecfdb0",
  addr_in_sc: "0x00c097f24ae4dd09359f87d85bc883a72a5a46c7"
};

var rawtx = "0xf86c0a85046c7cfe0083016dea94d1310c1e038bc12865d3d3997275b3e4737c6302880b503be34d9fe80080269fc7eaaa9c21f59adf8ad43ed66cf5ef9ee1c317bd4d32cd65401e7aaca47cfaa0387d79c65b90be6260d09dcfb780f29dd8133b9b1ceb20b83b7e442b4bfc30cb";

var api = null;
var coinAPI = null;

describe('api.eth', async () => {

  beforeEach(async () => {
    api = new InfinitoApi(opts);
    coinAPI = api.ETH;
  });

  it('#getTxAddress(address)', async () => {
    let info = await coinAPI.getTxAddress(addresses.normal);
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('total');
    info.data.should.have.property('from');
    info.data.should.have.property('to');
    info.data.should.have.property('transactions');
  });

  it('#getInternalTxAddress(address)', async () => {
    let info = await coinAPI.getInternalTxAddress(addresses.normal);
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('total');
    info.data.should.have.property('from');
    info.data.should.have.property('to');
    info.data.should.have.property('transactions');
  });

  it('#getTxCount(address)', async () => {
    let info = await coinAPI.getTxCount(addresses.normal);
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('tx_count');
  });

  it('#getNonce(address)', async () => {
    let info = await coinAPI.getNonce(addresses.normal);
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('nonce');
  });

  it('#getBalance(address)', async () => {
    let info = await coinAPI.getBalance(addresses.normal);
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('addr');
    info.data.should.have.property('balance');
  });

  it('#getContract()', async () => {
    let info = await coinAPI.getContract();
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('total');
    info.data.should.have.property('from');
    info.data.should.have.property('to');
    info.data.should.have.property('contracts');
  });

  it('#getSmartContractInfo(sc)', async () => {
    let info = await coinAPI.getSmartContractInfo(addresses.sc);
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('address');
    info.data.should.have.property('name');
    info.data.should.have.property('symbol');
    info.data.should.have.property('decimals');
    info.data.should.have.property('total_supply');
  });

  it('#getContractHistory(sc)', async () => {
    let info = await coinAPI.getContractHistory(addresses.sc);
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('total');
    info.data.should.have.property('from');
    info.data.should.have.property('to');
    info.data.should.have.property('transactions');
  });

  it('#getContractBalance(sc, addr_in_sc)', async () => {
    let info = await coinAPI.getContractBalance(addresses.sc, addresses.addr_in_sc);
    // console.log(info);
    info.should.have.property('cd');
    info.should.have.property('data');
    info.data.should.have.property('addr');
    info.data.should.have.property('balance');
  });

  it('#sendTransaction(rawtx)', async () => {
    let info = await coinAPI.sendTransaction({rawtx: rawtx});
    // console.log(info);
    info.should.have.property('cd');
  });

});
